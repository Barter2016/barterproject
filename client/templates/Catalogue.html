<div ng-cloak id="catalog-view">

    <!-- Loading -->
    <div class="loading grey-background" layout="column" layout-align="center center" ng-show="!data_loaded">
        <md-progress-circular md-mode="indeterminate" class="md-primary" md-diameter="80"></md-progress-circular>
    </div>

    <!-- Page content -->
    <div layout="column" flex ng-show="data_loaded">
        <md-tabs md-dynamic-height md-border-bottom md-stretch-tabs="always">
            
            <!-- My catalog tab -->
            <md-tab label="Mon catalogue">
                <md-card flexs>
                    <md-card-title class="border-bottom">
                        <md-subheader class="md-primary md-no-sticky">Mes annonces</md-subheader>
                    </md-card-title>
                    <md-card-content class="no-padding">
                        <md-list class="offers-list">
                            <div ng-repeat="product in products | orderBy: 'product_date':true " layout="row" layout-align="center center" class="hover border-bottom">
                                <md-list-item class="md-2-line" flex  ng-click="viewProduct(product.product_id.S)">
                                    <div class="list-image" layout="column" layout-align="center center">
                                        <img ng-src="{{ product.image_urls['SS'][0] }}" />
                                    </div>
                                    <div class="md-list-item-text" layout="column">
                                        <h3>{{ product.product_name.S }}</h3>
                                        <p>{{ product.product_description.S }}</p>
                                    </div>
                                </md-list-item>                         
                                <div layout="column" layout-align="center center" class="item-buttons">
                                    <md-button flex class="md-icon-button md-primary" ng-click="editProduct(product.product_id.S)">
                                        <md-icon class="material-icons">mode_edit</md-icon>
                                        <md-tooltip md-direction="left">Modifier</md-tooltip>
                                    </md-button>
                                    <md-button flex class="md-icon-button md-primary" ng-click="deleteProduct($event,product)">
                                        <md-icon class="material-icons">delete</md-icon>
                                        <md-tooltip md-direction="left">Supprimer</md-tooltip>
                                    </md-button>
                                </div>
                            </div>
                        </md-list>
                    </md-card-content>
                </md-card>
            </md-tab>
            
            <!-- Add a product tab -->
            <md-tab label="Ajouter une annonce">
                <md-card flex>
                    <md-card-content>
                        <form ng-submit="submit()" class="md-inline-form" enctype="multipart/form-data" name="addProductForm" ng-cloak>
                            <div layout="row">
                                <md-input-container class="md-block" flex-gt-sm>
                                    <label>Nom du produit</label>
                                    <input ng-model="new_product.product_name" name="productName" required>
                                    <div ng-messages="addProductForm.productName.$error">
                                        <div ng-message="required">Veuillez entrer le nom de votre nouveau produit.</div>
                                    </div>
                                </md-input-container>
                            </div>
                            <div layout="row">
                                <md-input-container class="md-block" flex-gt-sm>
                                    <label>Description du produit</label>
                                    <input name="productDescription" type="textarea" ng-model="new_product.product_description" md-maxlength="200" rows="5" md-select-on-focus required>
                                    <div ng-messages="addProductForm.productDescription.$error">
                                        <div ng-message="required">Veuillez entrer la description de votre nouveau produit.</div>
                                    </div>
                                </md-input-container>
                            </div>
                            <div layout="row">
                                <md-input-container class="md-block" flex>
                                    <label>Categories</label>
                                    <md-select ng-model="new_product.category_id" name "productCategory" required>
                                        <md-option ng-repeat="category in categories | orderBy: 'category_name.S'" value={{category.category_id.S}}>{{category.category_name.S}}</md-option>
                                    </md-select>
                                    <div ng-messages="addProductForm.productCategory.$error">
                                        <div ng-message="required">Veuillez sélectionner la catégorie de votre nouveau produit.</div>
                                    </div>
                                </md-input-container>
                                <md-input-container class="md-block" flex>
                                    <input ng-model="imagesToUpload" onchange="angular.element(this).scope().fileChanged()" id="imageFile" name="file[]" type="file" multiple />
                                </md-input-container>
                            </div>
                            <div layout="row" layout-align="center center">
                                
                                <!-- Loading -->
                                <md-progress-circular ng-show="imagesAreLoading" md-mode="indeterminate" class="md-primary" md-diameter="80"></md-progress-circular>
                                
                                <div flex="30" layout="column" layout-align="center center" ng-show="imagesToPreview.length > 0 && !imagesAreLoading">
                                    <ul class="photos-navigation">
                                        <li ng-repeat="img in imagesToPreview" flex ng-hide="!isCurrentImgIndex($index)">
                                            <img ng-src="{{ img.image.src }}" class="md-card-image" />
                                        </li>
                                    </ul>
                                     <div ng-show="imagesToPreview.length > 1">
                                        {{ currentImgIndex + 1 }} / {{ imagesToPreview.length }}
                                    </div>
                                    <div class="photos-scroll" flex layout="row" ng-show="imagesToPreview.length > 1">
                                        <md-button class="md-icon-button md-primary" ng-click="showPreviousImg()">
                                            <md-icon class="material-icons">arrow_back</md-icon>
                                            <md-tooltip md-direction="left">Photo prédécente</md-tooltip>
                                        </md-button>
                                        <md-button class="md-icon-button md-primary" ng-click="showNextImg()">
                                            <md-icon class="material-icons">arrow_forward</md-icon>
                                            <md-tooltip md-direction="right">Photo suivante</md-tooltip>
                                        </md-button>
                                    </div>
                                </div>
                                
                            </div>
                        </form>
                    </md-card-content>
                    <md-divider></md-divider>
                    <md-card-actions layout="row" layout-align="start center">
                        <md-button class="md-raised md-primary" ng-disabled="addProductForm.$invalid" ng-click="addProduct(new_product)">Ajouter mon annonce</md-button>
                        <span flex></span>
                    </md-card-actions>
                </md-card>
            </md-tab>
            
        </md-tabs>
    </div>
</div>
